# Base de datos

## Motor y base
- Motor: MySQL 8.
- Base por defecto: `empleof_db`.
- Script de inicializacion: `init.sql`.

## Tablas principales

### Seguridad y acceso
- `usuarios`: credenciales, rol y estado (`candidato`, `empresa`, `administrador`, `superadmin`).

### Perfil del candidato
- `candidatos`: entidad principal del candidato, enlaza opcionalmente con `usuarios`.
- `candidatos_contacto`: email, telefonos y contacto de emergencia (1:1).
- `candidatos_domicilio`: direccion del candidato (1:1).
- `candidatos_salud`: tipo de sangre, estatura, peso, tatuaje (1:1).
- `candidatos_logistica`: movilidad, licencia y disponibilidad (1:1).
- `candidatos_educacion_general`: multiples registros de educacion general del candidato (1:N).
- `candidatos_idiomas`: idiomas y nivel (1:N).
- `candidatos_experiencia`: historial laboral (1:N).
- `candidatos_formaciones`: cursos/formaciones (1:N).
- `candidatos_formacion_resultados`: resultado 1:1 por registro de `candidatos_formaciones`.
- `candidatos_documentos`: documentos del candidato (1:N, con unicidad por `candidato_id + tipo_documento`).
- `candidatos_experiencia_certificados`: certificado laboral 1:1 por experiencia.

### Integraciones
- `candidatos_origen`: mapeo candidato local contra origen externo (`ademy`).
- `candidatos_formaciones_origen`: mapeo formaciones locales contra formaciones externas.
- `integracion_sync_state`: ultima sincronizacion por origen.
- `integracion_sync_logs`: bitacora de ejecuciones de sincronizacion.

## Relaciones clave
- `candidatos.usuario_id -> usuarios.id` (ON DELETE SET NULL).
- Tablas satelite 1:1 (`contacto`, `domicilio`, `salud`, `logistica`) usan PK = `candidato_id` y FK con ON DELETE CASCADE.
- `candidatos_idiomas`, `candidatos_experiencia`, `candidatos_formaciones`, `candidatos_documentos` usan FK a `candidatos.id`.
- `candidatos_educacion_general` usa FK a `candidatos.id`.
- `candidatos_formacion_resultados.candidato_formacion_id -> candidatos_formaciones.id` (UNIQUE, ON DELETE CASCADE).
- `candidatos_experiencia_certificados.experiencia_id -> candidatos_experiencia.id` (UNIQUE, ON DELETE CASCADE).

## Extension Fase 2 (formacion/experiencia)
- `candidatos_formaciones` extiende campos de perfil:
  - `categoria_formacion`, `subtipo_formacion`
  - `institucion`, `nombre_programa`, `titulo_obtenido`
  - `entidad_emisora`, `numero_registro`, `fecha_emision`, `fecha_vencimiento`
- Todos los campos nuevos son `NULL`-friendly para no romper importaciones existentes.
- Separacion funcional vigente:
  - `candidatos_educacion_general`: formacion academica (tab Academica, multiple).
  - `candidatos_formaciones`: formacion externa/importada (tab Externa).
  - `candidatos_experiencia_certificados`: certificacion laboral por experiencia.

## Indices y reglas importantes
- `usuarios.email` es unico.
- `candidatos.documento_identidad` es unico.
- `candidatos_documentos` tiene unico `uk_candidato_tipo_doc`.
- Mapeos de origen tienen unicidad por origen (`uq_origen_candidato`, `uq_origen_formacion`).

## Notas operativas
- Varias tablas tienen `deleted_at` para borrado logico.
- El backend filtra candidatos activos acreditados para listado de talento.
- La sincronizacion Ademy mantiene estado en `integracion_sync_state` y detalle en `integracion_sync_logs`.
